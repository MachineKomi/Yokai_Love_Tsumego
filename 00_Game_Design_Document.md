Here is the **Game Design Document (GDD)**. This serves as the "Constitution" for the project. It translates the high-level pitch into actionable mechanics, loops, and systems that our AI Agents can implement.

It is designed to be **modular** (so we can cut features if scope creeps) and **technically grounded** in the Architecture we agreed upon (Supabase + React + KataGo).

***

# 00_Game_Design_Document.md

# Tsumego Tower: The Divine Ascent
Here is the **Game Design Document (GDD)**. This serves as the "Constitution" for the project. It translates the high-level pitch into actionable mechanics, loops, and systems that our AI Agents can implement.

It is designed to be **modular** (so we can cut features if scope creeps) and **technically grounded** in the Architecture we agreed upon (Supabase + React + KataGo).

***

# 00_Game_Design_Document.md

# Tsumego Tower: The Divine Ascent
**Project Code:** `tsumego-tower`
**Version:** 1.0.0
**Status:** In Development

---

## 1. Executive Summary

**Tsumego Tower** is a "Nostalgic 90s Anime" puzzle RPG. The Demon Lord has banned Go, and the Player must climb the tower to tame Yokai, Goddesses, and Devils to defeat the Demon Lord’s tyranny.

**The Hook:** "The Demon Lord has banned Go. Climb the tower, tame the Yokai, and bring logic back to the world."
**Target Audience:** Go players (25k to 9d), fans of logic puzzles, and fans of anime/VN aesthetics.
**Platform:** Web (PWA), Steam (PC/Mac/Linux via Tauri), Mobile (iOS/Android wrapper).

---

## 2. Core Gameplay Loop

The game features a **Two-Phase Loop** where Puzzle Solving and Combat are distinct activities.

1.  **Phase 1: The Study (Banking):** The player solves Tsumego puzzles to "Bank" resources (Mana, Crystalline Aji, Gold, Stamina).
2.  **Phase 2: The Hunt (Spending):** The player uses banked Stamina to engage in Auto-Battles (Hunts or Boss Challenges) to progress the RPG layer.
3.  **Progression:** Even if a player’s Go skill (Rank) stagnates, their RPG stats (Level, Companion Intimacy) must always progress via grinding.
4.  **The Respite (VN/Dating):** Between loops, players interact with companions, view cutscenes, and customize their experience.

---

## 3. Game Mechanics: The Tower (Puzzle Gameplay)

### 3.1. The Puzzle System (Tsumego)
"Combat" in the puzzle phase is placing the correct stone on a Go board.
* **Input:** Point-and-click (Mouse) or Tap (Touch).
* **The Enemy:** An AI-generated board state (generated by our Python/KataGo pipeline).
* **Win Condition:** Find the *only* move that kills the enemy group or saves the player's group (Standard Life & Death).
* **Fail State:** Playing a suboptimal move. The system immediately refutes the move (plays the punishment) and marks the puzzle as "Failed."

### 3.2. Difficulty Scaling & The "Elo" System
* **Floors 1-10:** Beginner (25k - 20k). One-move kill/save.
* **Floors 11-50:** Intermediate (19k - 10k). Simple sequences (3-5 moves).
* **Floors 51-100:** Advanced (9k - 1d). Complex shapes, under-the-stones, snapbacks.
* **The Infinite Spire (100+):** Dan level (1d - 9d+). Pro-level blunders and deep reading problems.
* *Note:* Difficulty is dynamically adjusted. If a player fails 3 times on a floor, they are offered a "Demotion" or a "Hint."

### 3.3. The Streak System
To encourage consistent practice, we implement two distinct streak types:

1.  **Mana Streak:** Breaks on **puzzle failure**. Rewards high immediate bonuses (Mana & Crystalline Aji).
2.  **Study Streak:** Breaks on **inactivity (>36 hours)**. Rewards compounding long-term bonuses (All currencies).
*   **Shield Items:** Players can use limited items to shield these streaks (2/day for Mana, 2/week for Study).

### 3.4. Teaching Mode & "God's Eye"
Players can enter "Analysis Mode" after solving (or failing) a puzzle.
* **Engine:** Powered by client-side KataGo (WASM).
* **Emotional Aura (Visualizer):** A toggleable overlay.
    * **Blue/Calm Aura:** Safe territory (100% owner).
    * **Red/Jagged Aura:** Contested/Weak groups.
    * **Purple Haze:** Dead stones.
* **Variation Tree:** Players can play out "What if?" scenarios. The AI responds to their moves to show *why* a variation doesn't work.

---

## 4. Game Mechanics: The Harem (VN/Dating)

### 4.1. Companions (Waifus)
Characters are unlocked by defeating "Boss Floors".
*   **Starter:** The player starts with a specific "Neko Yokai" (Cheeky/Sarcastic Pet/Guide) + one Gacha roll.
*   **Yokai:** Standard companions.
*   **Goddesses:** Rare companions.
*   **Duplicates:** Pulling a dupe grants "Essence" used to increase Rank/Stats (but not Level).

### 4.2. Interaction
* **Home Screen:** The active companion stands in the lobby (Live2D/Animated Sprite).
*   **Dates:** Visual Novel style with choices.
*   **Gifting:** Core mechanic. Specific gifts boost intimacy more based on preferences (bonuses for Star Sign/Birthdays).
*   **Unlocks:** High-tier romance scenes and outfits are gated by Tower Floor + Intimacy Level.

### 4.3. Customization
Players can customize the "Cosplay" of their companions (outfits unlocked via gameplay or premium currency).

---

## 5. Economy & Monetization

### 5.1. Currencies
*   **Mana:** Earned from Puzzles. Used to level up Attack/Abilities.
*   **Crystalline Aji:** Earned from Puzzles. Used to upgrade Base Stats/Level.
*   **Gold:** Earned from Puzzles. Used for Shop items (Costumes, Gifts, Board Skins).
*   **Stamina:** Earned from Puzzles. Consumed to "Hunt" (farm mobs) or "Challenge Boss".
*   **Talismans:** Rare drops/Boss rewards. Used to summon new Companions.
*   **Magical Collar:** Premium item. Guarantees a *new* companion (no dupes).

### 5.2. RPG Combat (Auto-Battler)
*   **Visual Style:** **Abstract & Text-Heavy.** High-quality static portraits, scrolling Combat Log, particle effects. No animated battle sprites.
*   **Mechanics:** Auto-Battler. Strategy is in Team Comp/Setup.
*   **Roles:** Tank, Healer, Phys DPS, Magic DPS, Trapper, Alchemist, Control.
*   **Limit Breaks:** Real-time interaction. Tap to trigger ultimate move.
*   **No Death Penalty:** Losing combat only wastes Stamina. No loss of accrued Mana/Gold.
*   **Avatar Role:** "Commander". Stats/Intimacy boost Companions. Does not fight directly.

### 5.3. Subscription & Monetization
*   **Free Players:** Limited daily puzzles.
*   **Premium Subscription:** 64 puzzles/day cap.
*   **Microtransactions:** Talismans, Magical Collars, Cosmetic Packs.

---

## 6. Technical & AI Implementation Strategy

### 6.1. The AI Factory (Backend)
* **Role:** Offline generation of content.
* **Process:** Python script + KataGo scans SGF libraries -> Detects blunders -> Crops local position -> Validates "Unique Solution" -> Uploads to Supabase.
* **Expansion:** Every 1 raw puzzle is permuted into 8 variations (4 Rotations x 2 Flips/Color Swaps).
* **Volume:** We aim for 100,000+ stored puzzles at launch.

### 6.2. The AI Client (Frontend)
* **Role:** Real-time feedback and fallback.
* **Process:** `katago-js` (WASM) runs in a Web Worker. Used for "Analysis Mode" and as a fallback if the player plays a move not in the pre-baked tree (future proofing).

### 6.3. AI Art Assets
* **Backgrounds:** Stable Diffusion (Anime Scenery, Fantasy Towers).
* **Sprites:** Midjourney/Niji (Character Design) -> Manual cleanup/cutting -> Live2D/Spine animation.
* **CGs:** High-fidelity AI generation + manual paint-over for "Ecchi" elements to ensure quality and consistency.

---

## 7. User Interface (UI) Structure

**The "Central Square" Strategy:**
*   **Desktop (Landscape):** Interactive board/key UI in a central 1:1 container. Info panels/Art flank the sides.
*   **Mobile (Portrait):** 1:1 container in center. Info panels/Art stack above and below.
*   **Input:** User Option: "One Tap Move" OR "Tap to Place + Tap to Confirm".

1.  **Splash Screen:** Title, "Touch to Start."
2.  **Main Lobby (Home):**
    * Background: The Player's Room (Customizable).
    * Foreground: Active Waifu.
    * Buttons: "Climb Tower", "Companions", "Shop", "Settings", "Study".
3.  **Tower Map:** Vertical scrolling map showing floors and boss nodes.
4.  **Game Board:**
    * Center: 19x19 (or cropped) Go Board.
    * Top: Progress bar, Streak Counter.
    * Bottom: "Place Stone" (Mobile friendly), "Pass", "Hint".
5.  **VN Scene:** Standard dialogue box (bottom), Character Sprite (center), Background.

---

## 8. Development Phases (Vertical Slice Focus)

**Phase 1: The Skeleton (Current)**
* Local Supabase Setup.
* Basic React+Pixi Board.
* Ability to load 1 static puzzle and play stones.

**Phase 2: The Loop**
* Win/Loss logic.
* Simple "Streak" counter.
* Unlocking 1 static Image Reward upon clearing Floor 1.

**Phase 3: The Polish**
* KataGo WASM integration for analysis.
* Full Waifu UI and Affection system.
* Steam Integration.

---

## 9. Tone & Safety Guidelines
* **ESRB Rating Target:** "T for Teen" or "M for Mature" (depending on platform).
* **Safety:** No "Safe Mode" toggle. The content is "Steam Safe" (Ecchi/Spicy but not explicit/banned content).
* **Steam:** "Ecchi" is allowed, but no explicit genitalia/hardcore content. We focus on "Romance," "Suggestive Themes," and "Fan Service."
* **Vibe:** Wholesome but spicy. The Waifus genuinely want to help you get better at Go.